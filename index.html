<!DOCTYPE html>
<html>
  <head>

  </head>
  <body>


    <script>
      // guide from https://github.com/jsantell/browser-dance-party-slides/blob/master/index.html

      var SAMPLE_RATE = 44100;
      var NYQUITS = SAMPLE_RATE / 2;
      var BUFFER_SIZE = 2048;
      var FFT_SIZE = BUFFER_SIZE / 2;
      var BIN_COUNT = FFT_SIZE / 2;

      var context = new webkitAudioContext();
      var source = context.createBufferSource();
      var analyser = context.createAnalyser();
      var processor = context.createScriptProcessor(BUFFER_SIZE, 1, 1);
      var fft = new Uint8Array(BIN_COUNT);

      analyser.fftSize = FFT_SIZE;

      // frequency per bin = nyquits / binCount

      /** event at http://www.w3.org/TR/webaudio/#AudioProcessingEvent-section */
      processor.onaudioprocess = function(event) {
        analyser.getByteFrequencyData(fft);
        var max = 0;
        var maxBin = -1;

        for (var i = 0; i < BIN_COUNT; i++) {
          if (fft[i] > max) {
            max = fft[i];
            maxBin = i;
          }
        }
        console.log(maxBin, max);
      };

      // Load MP3
      var xhr = new XMLHttpRequest();
      xhr.open('GET', './OneDrop.mp3', true);
      xhr.responseType = 'arraybuffer';
      xhr.onload = function() {
        context.decodeAudioData(xhr.response, function(decoded) {
          source.buffer = decoded;
          source.connect(analyser);
          analyser.connect(processor);
          processor.connect(context.destination);
          source.start(0);
        }, function() {
          console.log('error');
          console.log(arguments);
        });
      };
      xhr.send();
    </script>
  </body>
</html>